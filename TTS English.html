<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS英文评测数据看板</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dimension-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .dimension-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007bff; /* 维度按钮改为蓝色 */
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        .dimension-btn.active {
            background-color: #0056b3; /* 激活状态蓝色 */
        }
        .dashboard {
            display: none;
        }
        .dashboard.active {
            display: block;
        }
        .chart-container {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .download-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .download-btn:hover {
            background-color: #218838;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        .data-table th:first-child, .data-table td:first-child {
            text-align: left;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
        .mini-row {
            font-weight: bold;
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <h1>TTS英文评测数据看板</h1>
    <div class="dimension-buttons">
        <button class="dimension-btn active" data-dimension="stability">稳定性</button>
        <button class="dimension-btn" data-dimension="quality">音质</button>
        <button class="dimension-btn" data-dimension="naturalness">自然度</button>
    </div>

    <!-- 稳定性看板 -->
    <div class="dashboard active" id="stability">
        <div class="chart-container">
            <h2>稳定性 - 男性</h2>
            <canvas id="stability-male-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="stability-male-table"></tbody>
            </table>
            <button class="download-btn" data-chart="stability-male-chart">下载图表</button>
        </div>
        <div class="chart-container">
            <h2>稳定性 - 女性</h2>
            <canvas id="stability-female-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="stability-female-table"></tbody>
            </table>
            <button class="download-btn" data-chart="stability-female-chart">下载图表</button>
        </div>
    </div>

    <!-- 音质看板 -->
    <div class="dashboard" id="quality">
        <div class="chart-container">
            <h2>音质 - 男性</h2>
            <canvas id="quality-male-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="quality-male-table"></tbody>
            </table>
            <button class="download-btn" data-chart="quality-male-chart">下载图表</button>
        </div>
        <div class="chart-container">
            <h2>音质 - 女性</h2>
            <canvas id="quality-female-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="quality-female-table"></tbody>
            </table>
            <button class="download-btn" data-chart="quality-female-chart">下载图表</button>
        </div>
    </div>

    <!-- 自然度看板 -->
    <div class="dashboard" id="naturalness">
        <div class="chart-container">
            <h2>自然度 - 男性</h2>
            <canvas id="naturalness-male-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="naturalness-male-table"></tbody>
            </table>
            <button class="download-btn" data-chart="naturalness-male-chart">下载图表</button>
        </div>
        <div class="chart-container">
            <h2>自然度 - 女性</h2>
            <canvas id="naturalness-female-chart"></canvas>
            <table class="data-table">
                <thead>
                    <tr><th>模型</th><th>原始值</th><th>与mini差值</th></tr>
                </thead>
                <tbody id="naturalness-female-table"></tbody>
            </table>
            <button class="download-btn" data-chart="naturalness-female-chart">下载图表</button>
        </div>
    </div>

    <script>
        // 等待DOM加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 数据处理
            const data = {
                stability: {
                    male: {
                        mini: 0.980,
                        models: {
                            openspeech: 1,
                            "speech-02-hd": 0.949,
                            "speech-02-turbo": 0.949,
                            vivid: 0.990
                        }
                    },
                    female: {
                        mini: 0.969,
                        models: {
                            openspeech: 1,
                            "speech-02-hd": 0.990,
                            "speech-02-turbo": 1,
                            vivid: 0.969
                        }
                    }
                },
                quality: {
                    male: {
                        mini: 4.88,
                        models: {
                            openspeech: 4.95,
                            "speech-02-hd": 4.82,
                            "speech-02-turbo": 4.64,
                            vivid: 4.93
                        }
                    },
                    female: {
                        mini: 4.81,
                        models: {
                            openspeech: 4.97,
                            "speech-02-hd": 4.86,
                            "speech-02-turbo": 4.60,
                            vivid: 4.87
                        }
                    }
                },
                naturalness: {
                    male: {
                        mini: 4.77,
                        models: {
                            openspeech: 4.60,
                            "speech-02-hd": 4.92,
                            "speech-02-turbo": 4.96,
                            vivid: 4.76
                        }
                    },
                    female: {
                        mini: 4.67,
                        models: {
                            openspeech: 4.76,
                            "speech-02-hd": 4.90,
                            "speech-02-turbo": 4.96,
                            vivid: 4.67
                        }
                    }
                }
            };

            // 计算差值并排序（所有数值保留4位小数）
            function processData(dimension, gender) {
                const miniValue = data[dimension][gender].mini;
                const models = data[dimension][gender].models;
                const diffs = [];
                
                for (const [model, value] of Object.entries(models)) {
                    const diff = value - miniValue; // 保留原始精度
                    diffs.push({ 
                        model, 
                        value, 
                        diff: parseFloat(diff.toFixed(4)), // 改为4位小数
                        diffStr: diff >= 0 ? '+' + diff.toFixed(4) : diff.toFixed(4) // 改为4位小数
                    });
                }
                
                // 按差值从低到高排序
                diffs.sort((a, b) => a.diff - b.diff);
                return diffs;
            }

            // 创建图表
            function createChart(canvasId, dimension, gender) {
                const processed = processData(dimension, gender);
                const miniValue = data[dimension][gender].mini;
                const ctx = document.getElementById(canvasId).getContext('2d');
                
                const labels = processed.map(item => item.model);
                const values = processed.map(item => item.diff);
                // 将绿色柱状图改为深绿色
                const colors = values.map(diff => diff >= 0 ? 'rgba(0, 128, 0, 0.7)' : 'rgba(255, 0, 0, 0.7)');
                
                // 填充数据表格 - 先添加mini行
                const tableBody = document.getElementById(`${dimension}-${gender}-table`);
                tableBody.innerHTML = '';
                
                // 添加mini模型行（基准值）- 将0.000000改为/
                const miniRow = document.createElement('tr');
                miniRow.className = 'mini-row';
                miniRow.innerHTML = `
                    <td>mini (基准)</td>
                    <td>${miniValue.toFixed(4)}</td>
                    <td>/</td>
                `;
                tableBody.appendChild(miniRow);
                
                // 添加其他模型行
                processed.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.model}</td>
                        <td>${item.value.toFixed(4)}</td>
                        <td class="${item.diff >= 0 ? 'positive' : 'negative'}">${item.diffStr}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
                return new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '与mini模型的差值',
                            data: values,
                            backgroundColor: colors,
                            borderColor: colors.map(c => c.replace('0.7', '1')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        // 去掉图例
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `差值: ${context.raw >= 0 ? '+' : ''}${context.raw.toFixed(4)}`; // 改为4位小数
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: '差值'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(4); // 显示4位小数
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: '模型'
                                }
                            }
                        }
                    }
                });
            }

            // 初始化所有图表
            const charts = {
                stability: {
                    male: createChart('stability-male-chart', 'stability', 'male'),
                    female: createChart('stability-female-chart', 'stability', 'female')
                },
                quality: {
                    male: createChart('quality-male-chart', 'quality', 'male'),
                    female: createChart('quality-female-chart', 'quality', 'female')
                },
                naturalness: {
                    male: createChart('naturalness-male-chart', 'naturalness', 'male'),
                    female: createChart('naturalness-female-chart', 'naturalness', 'female')
                }
            };

            // 维度切换
            document.querySelectorAll('.dimension-btn').forEach(button => {
                button.addEventListener('click', () => {
                    // 移除所有active类
                    document.querySelectorAll('.dimension-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.dashboard').forEach(dash => dash.classList.remove('active'));
                    
                    // 添加active类到当前按钮和对应看板
                    button.classList.add('active');
                    const dimension = button.dataset.dimension;
                    document.getElementById(dimension).classList.add('active');
                    
                    // 触发图表重绘以适应容器大小变化
                    if (charts[dimension]) {
                        Object.values(charts[dimension]).forEach(chart => chart.resize());
                    }
                });
            });

            // 下载功能
            document.querySelectorAll('.download-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const canvasId = this.dataset.chart;
                    const canvas = document.getElementById(canvasId);
                    
                    html2canvas(canvas).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `${canvasId}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    });
                });
            });
        });
    </script>
</body>
</html>